DROP DATABASE IF EXISTS BITPAY;
CREATE DATABASE BITPAY;
USE BITPAY;

CREATE TABLE USUARIOS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL UNIQUE,
    SENHA VARCHAR(100) NOT NULL,
    CPF VARCHAR(20) NOT NULL UNIQUE,
    DATA_NASCIMENTO DATE NOT NULL,
    LOGRADOURO VARCHAR(150),
    NUMERO VARCHAR(10),
    BAIRRO VARCHAR(100),
    CIDADE VARCHAR(100),
    ESTADO CHAR(2),
    TELEFONE VARCHAR(20)
);

CREATE TABLE COLABORADORES (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    EMAIL VARCHAR(100) NOT NULL UNIQUE,
    SENHA VARCHAR(100) NOT NULL,
    CPF VARCHAR(20) NOT NULL UNIQUE,
    LOGRADOURO VARCHAR(150),
    NUMERO VARCHAR(10),
    BAIRRO VARCHAR(100),
    CIDADE VARCHAR(100),
    ESTADO CHAR(2),
    TELEFONE VARCHAR(20),
    FUNCAO VARCHAR(50)
);

CREATE TABLE CONTAS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    USUARIO_ID INT NOT NULL,
    NUMERO_CONTA VARCHAR(20) UNIQUE NOT NULL,
    SALDO DECIMAL(10,2) DEFAULT 0,
    TIPO VARCHAR(20) DEFAULT 'CORRENTE',
    SITUACAO VARCHAR(20) DEFAULT 'ATIVA',
    FOREIGN KEY (USUARIO_ID) REFERENCES USUARIOS(ID)
);

CREATE TABLE TRANSFERENCIAS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    CONTA_ORIGEM INT NOT NULL,
    CONTA_DESTINO INT NOT NULL,
    VALOR DECIMAL(10,2) NOT NULL,
    DATA_HORA DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (CONTA_ORIGEM) REFERENCES CONTAS(ID),
    FOREIGN KEY (CONTA_DESTINO) REFERENCES CONTAS(ID)
);

CREATE TABLE EMPRESTIMOS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    CONTA_ID INT NOT NULL,
    VALOR DECIMAL(10,2) NOT NULL,
    PARCELAS INT NOT NULL,
    TAXA_JUROS DECIMAL(5,2) NOT NULL,
    VALOR_TOTAL DECIMAL(10,2) NOT NULL,
    STATUS VARCHAR(20) NOT NULL,
    DATA_CONTRATACAO DATE NOT NULL,
    FOREIGN KEY (CONTA_ID) REFERENCES CONTAS(ID)
);

CREATE TABLE EXTRATOS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    CONTA_ID INT NOT NULL,
    TIPO VARCHAR(20) NOT NULL,
    VALOR DECIMAL(10,2) NOT NULL,
    DATA_HORA DATETIME DEFAULT CURRENT_TIMESTAMP,
    DESCRICAO VARCHAR(255),
    FOREIGN KEY (CONTA_ID) REFERENCES CONTAS(ID)
);

CREATE TABLE INVESTIMENTOS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(100) NOT NULL,
    RISCO VARCHAR(20) NOT NULL,
    RENTABILIDADE DECIMAL(5,2) NOT NULL
);

CREATE TABLE APLICACOES (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    ID_CONTA INT NOT NULL,
    ID_INVESTIMENTO INT NOT NULL,
    VALOR DECIMAL(10,2) NOT NULL,
    DATA_APLICACAO DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ID_CONTA) REFERENCES CONTAS(ID),
    FOREIGN KEY (ID_INVESTIMENTO) REFERENCES INVESTIMENTOS(ID)
);

CREATE TABLE PARCELAS (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    EMPRESTIMO_ID INT NOT NULL,
    NUMERO INT NOT NULL,
    VALOR DECIMAL(10,2) NOT NULL,
    DATA_VENCIMENTO DATE NOT NULL,
    STATUS VARCHAR(20) NOT NULL DEFAULT 'PENDENTE',

    CONSTRAINT FK_PARCELAS_EMPRESTIMOS
    FOREIGN KEY (EMPRESTIMO_ID)
    REFERENCES EMPRESTIMOS(ID)
    ON DELETE CASCADE
);


INSERT INTO COLABORADORES (NOME, EMAIL, SENHA, CPF) VALUES
('GERENTE', 'gerente@gmail.com', "123456", '12345678901'); 

INSERT INTO INVESTIMENTOS (NOME, RISCO, RENTABILIDADE) VALUES
('CDB Banco XP', 'Baixo', 10.50),
('Tesouro Selic 2029', 'Baixo', 9.75),
('Fundo Multimercado Alpha', 'Médio', 15.20),
('Ações PETR4', 'Alto', 30.00);
